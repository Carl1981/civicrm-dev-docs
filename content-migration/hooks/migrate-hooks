#!/usr/bin/env php
<?php

include __DIR__ . '/hooks-by-category.php';

$cache_dir = __DIR__ . '/wiki_cache';
$root_dir = dirname(dirname(__DIR__));
$hooks_dir = "$root_dir/docs/hooks";

# create hooks directory if needed
if ( !is_dir($hooks_dir) ) {
  mkdir($hooks_dir);
}

chdir($hooks_dir);

foreach ($hooks_by_category as $category => $hooks) {
  foreach ($hooks as $hook) {
    $hook_name = $hook['name'];
    $hook_file = "$hook_name.md";
    $html = "$cache_dir/$hook_name";
    if ( file_exists($html) && !file_exists($hook_file) ) {
      echo "converting $hook_name ... ";
      $conversion_status = 1;
      system("webpage2md $html > $hook_file", $conversion_status);
      // TODO fix links that point to wiki using only a slash
      if( $conversion_status == 0 ) {
        echo "done" . PHP_EOL;
      }
      else {
        echo "ERROR CONVERTING $hook_name" . PHP_EOL;
      }
    }
    else if ( !file_exists($html) ) {
      echo "WARNING: $hook_name not yet fetched" . PHP_EOL;
    }
    else if ( file_exists($hook_file) ) {
      echo "ignoring $hook_name (hook file already exists)" . PHP_EOL;
    }
  }
}




