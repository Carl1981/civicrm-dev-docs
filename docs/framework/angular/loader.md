# AngularJS: Loader

What happens when a user visits a CiviCR-Angular page? For example, let's
consider this URL:

 * `https://example.org/civicrm/a/#/mailing/new`

Broadly speaking, two things happen:

 1. (Server-side) CiviCRM processes the request for `civicrm/a`. It
    displays a web-page with all your Angular modules.
 2. (Client-side) AngularJS processes the request for `mailing/new`.
    It uses an HTML template to setup the UI.

The client-side behavior is well-defined by Angular
[ngRoute](https://docs.angularjs.org/api/ngRoute).  We'll explore the
server-side in greater depth because that is unique to the CiviCRM-Angular
integration.

## The library of AngularJS modules

CiviCRM needs a list of available AngularJS modules.  Technically, these
modules are defined via
[hook_civicrm_angularModules](/hooks/hook_civicrm_angularModules.md), e.g.

```php
/**
 * Implements hook_civicrm_angularModules.
 */
function foobar_civicrm_angularModules(&$angularModules) {
  $angularModules['myBigAngularModule'] = array(
    'ext' => 'org.example.foobar',
    'basePages' => array('civicrm/a'),
    'requires' => array('crmUi', 'crmUtils', 'ngRoute'),
    'js' => array('ang/myBigangularModule/*.js'),
    'css' => array('ang/myBigangularModule/*.css'),
    'partials' => array('ang/myBigangularModule'),
  );
}
```

!!! tip "Tip: Generating skeletal code with `civix`"
    In practice, this skeletal code can be autogenerated usin `civix`.
    For details, see [AngularJS: Quick Start](/framework/angular/quickstart.md).

The list of available modules varies depending on your system configuration:
if you install more CiviCRM extensions, then you might have more Angular
modules.  Use `cv` to inspect the list of available Angular modules:

```
$ cv ang:module:list
For a full list, try passing --user=[username].
+-------------------+-------------+------------------------------------------------------------------------------------+
| name              | basePages   | requires                                                                           |
+-------------------+-------------+------------------------------------------------------------------------------------+
| angularFileUpload | civicrm/a   |                                                                                    |
| bw.paging         | (as-needed) |                                                                                    |
| civicase          | (as-needed) | crmUi, crmUtil, ngRoute, angularFileUpload, bw.paging, crmRouteBinder, crmResource |
| crmApp            | civicrm/a   |                                                                                    |
| crmAttachment     | civicrm/a   | angularFileUpload, crmResource                                                     |
| crmAutosave       | civicrm/a   | crmUtil                                                                            |
| crmCaseType       | civicrm/a   | ngRoute, ui.utils, crmUi, unsavedChanges, crmUtil, crmResource                     |
...
```

!!! tip "Tip: More options for `cv ang:module:list`"
    * Use `--columns` to specify which columns to display. Ex: `cv ang:module:list --columns=name,ext,extDir`
    * Use `--out` to specify an output format. Ex: `cv ang:module:list --out=json-pretty`
    * Use `--user` to specify a login user using with. This may reveal permission-dependent modules. Ex: `cv ang:module:list --user=admin`

## The default base page (`civicrm/a`)

CiviCRM includes a default base-page named `civicrm/a`. Any module can add new routes on
this page.  The page might look like this:

```html
<!-- URL: https://example.org/civirm/a -->
<html>
<head>
<script type="text/javascript" src="https://example.org/.../angular.js"></script>
<script type="text/javascript" src="https://example.org/.../angular-route.js"></script>
<script type="text/javascript" src="https://example.org/.../crmApp.js"></script>
<script type="text/javascript" src="https://example.org/.../crmCaseType.js"></script>
<script type="text/javascript" src="https://example.org/.../crmMailing.js"></script>
<script type="text/javascript" src="https://example.org/.../crmUi.js"></script>
...
<link rel="stylesheet" href="https://example.org/.../crmUi.css" />
...
</head>
<body>
  <div ng-app="crmApp"></div>
</body>
</html>
```

!!! note "In practice, the JS files may be aggregated and/or minimized."

The markup is generated by a PHP class, `AngularLoader`, using logic like this:

```php
$loader = new \Civi\Angular\AngularLoader();
$loader->setModules(array('crmApp'));
$loader->setPageName('civicrm/a');
$loader->load();
```

The `load()` function determines the necessary JS/CSS/HTML/JSON resources
and loads them on the page. This will include:

 * Any AngularJS modules explicitly listed in `setModules(...)`. (Ex: `crmApp`)
 * Any AngularJS modules with matching `basePages`. (Ex: The value `civicrm/a`
   is specified by both `setPageName(...)` and `myBigAngularModule` [above].)
 * Any AngularJS modules transitively required by the above.

!!! note "What makes `civicrm/a` special?"
    When declaring a module, the property `basePages` will default to
    `array('civicrm/a')`.  In other words, if you don't specify otherwise,
    all modules are loaded on  `civicrm/a`.
